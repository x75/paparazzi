<!DOCTYPE airframe SYSTEM "airframe.dtd">

<!-- this is a quadrotor frame equiped with
     * Autopilot:   Lisa/M 2.0             http://paparazzi.enac.fr/wiki/Lisa/M_v20
     * IMU:         Aspirin 2.1            http://paparazzi.enac.fr/wiki/AspirinIMU
     * Actuators:   PWM motor controllers  http://paparazzi.enac.fr/wiki/Subsystem/actuators#PWM_Supervision
     * GPS:         Ublox                  http://paparazzi.enac.fr/wiki/Subsystem/gps
     * RC:          two Spektrum sats      http://paparazzi.enac.fr/wiki/Subsystem/radio_control#Spektrum
-->

<airframe name="Quadrotor LisaM_2.0 pwm">

  <firmware name="rotorcraft">
    <target name="ap" board="lisa_m_2.0">
      <configure name="LISA_M_BARO" value="BARO_MS5611_SPI"/>
      <subsystem name="radio_control" type="spektrum">
        <define name="RADIO_MODE" value="RADIO_AUX1"/>
        <!-- <define name="RADIO_AUTO_MODE" value="RADIO_AUX2"/> -->
      <!-- <define name="RADIO_KILL_SWITCH" value="RADIO_FLAPS"/> -->
      <!-- <define name="USE_KILL_SWITCH_FOR_MOTOR_ARMING" value="1"/> -->

        <!-- <configure name="USE_SECONDARY_SPEKTRUM_RECEIVER"
             value="1"/> -->
      </subsystem>
      <!-- MPU6000 is configured to output data at 2kHz, but polled at 512Hz PERIODIC_FREQUENCY -->
    </target>

    <target name="nps" board="pc">
      <subsystem name="fdm" type="jsbsim"/>
      <subsystem name="radio_control" type="ppm"/>
    </target>

    <subsystem name="motor_mixing"/>
    <subsystem name="actuators"     type="pwm">
      <define name="SERVO_HZ" value="400"/>
      <!--define name="USE_SERVOS_7AND8"/-->
    </subsystem>

    <subsystem name="telemetry"     type="transparent">
      <configure name="MODEM_BAUD"  value="B115200"/>
    </subsystem>
    <!-- <subsystem name="imu"           type="aspirin_v2.1"/> -->
    <subsystem name="imu"           type="aspirin_v2.2"/>
    <subsystem name="gps"           type="ublox"/>
    <subsystem name="stabilization" type="int_quat"/>
    <subsystem name="ahrs"          type="int_cmpl_quat">
      <configure name="USE_MAGNETOMETER" value="TRUE"/>
      <define name="AHRS_GRAVITY_HEURISTIC_FACTOR" value="30"/>
    </subsystem>
    <subsystem name="ins"/>

    <!-- <configure name="FLASH_MODE" value="DFU"/> -->
    <configure name="FLASH_MODE" value="JTAG_BMP"/>
    <configure name="BMP_PORT" value="/dev/ttyACM0"/>
    <!--define name="KILL_ON_GROUND_DETECT" value="TRUE"/-->
  </firmware>

  <modules main_freq="512">
    <load name="sys_mon.xml"/>
    <load name="gps_ubx_ucenter.xml"/>
    <load name="send_imu_mag_current.xml"/>
   <load name="nav_survey_rectangle_rotorcraft.xml">
      <define name="RECTANGLE_SURVEY_DEFAULT_SWEEP" value="10"/>
    </load>
  </modules>

  <servos driver="Pwm">
    <!-- <servo name="FRONT"   no="0" min="1000" neutral="1100" max="1900"/> -->
    <!-- <servo name="BACK"    no="1" min="1000" neutral="1100" max="1900"/> -->
    <!-- <servo name="RIGHT"   no="2" min="1000" neutral="1100" max="1900"/> -->
    <!-- <servo name="LEFT"    no="3" min="1000" neutral="1100" max="1900"/> -->
    <!-- <servo name="SW"   no="0" min="1000" neutral="1105" max="1900"/> -->
    <!-- <servo name="SE"    no="1" min="1000" neutral="1105" max="1900"/> -->
    <!-- <servo name="NW"   no="2" min="1000" neutral="1105" max="1900"/> -->
    <!-- <servo name="NE"    no="3" min="1000" neutral="1105" max="1900"/> -->
    <servo name="SW"   no="0" min="1000" neutral="1070" max="1900"/>
    <servo name="SE"   no="1" min="1000" neutral="1070" max="1900"/>
    <servo name="NW"   no="2" min="1000" neutral="1070" max="1900"/>
    <servo name="NE"   no="3" min="1000" neutral="1070" max="1900"/>
  </servos>

  <commands>
    <axis name="ROLL"   failsafe_value="0"/>
    <axis name="PITCH"  failsafe_value="0"/>
    <axis name="YAW"    failsafe_value="0"/>
    <axis name="THRUST" failsafe_value="0"/>
  </commands>

  <section name="MIXING" prefix="MOTOR_MIXING_">
    <define name="TRIM_ROLL" value="0"/>
    <define name="TRIM_PITCH" value="0"/>
    <define name="TRIM_YAW" value="0"/>
    <define name="NB_MOTOR" value="4"/>
    <define name="SCALE" value="256"/>
    <!-- front/back turning CW, right/left CCW -->
    <!-- <define name="ROLL_COEF"   value="{    0,    0, -256,  256 }"/> -->
    <!-- <define name="PITCH_COEF"  value="{  256, -256,    0,    0 }"/> -->
    <!-- <define name="YAW_COEF"    value="{ -256, -256,  256,  256 }"/> -->
    <!-- <define name="THRUST_COEF" value="{  256,  256,  256,  256 }"/> -->
    <!-- sw 1, se 2, nw 3, ne 4: 3 -> 1, 1 -> 4, 4 -> 3, 2 -> 2
         compared to quadx mixing in the wiki -->
    <!-- <define name="ROLL_COEF"   value="{  256, -256,  256, -256 }"/> -->
    <!-- <define name="PITCH_COEF"  value="{ -256, -256,  256,  256 }"/> -->
    <!-- <define name="YAW_COEF"    value="{ -256,  256,  256, -256 }"/> -->
    <!-- <define name="THRUST_COEF" value="{  256,  256,  256,  256 }"/> -->
    <define name="ROLL_COEF"   value="{  256, -256,  256, -256 }"/>
    <define name="PITCH_COEF"  value="{ -256, -256,  256,  256 }"/>
    <define name="YAW_COEF"    value="{ -256,  256,  256, -256 }"/>
    <define name="THRUST_COEF" value="{  256,  256,  256,  256 }"/>
  </section>

  <command_laws>
    <call fun="motor_mixing_run(autopilot_motors_on,FALSE,values)"/>
    <set servo="SW"  value="motor_mixing.commands[0]"/>
    <set servo="SE"   value="motor_mixing.commands[1]"/>
    <set servo="NW"  value="motor_mixing.commands[2]"/>
    <set servo="NE"   value="motor_mixing.commands[3]"/>
    <!-- <set servo="FRONT"  value="motor_mixing.commands[0]"/> -->
    <!-- <set servo="BACK"   value="motor_mixing.commands[1]"/> -->
    <!-- <set servo="RIGHT"  value="motor_mixing.commands[2]"/> -->
    <!-- <set servo="LEFT"   value="motor_mixing.commands[3]"/> -->
  </command_laws>

  <section name="IMU" prefix="IMU_">

    <!-- Calibration Neutral -->
    <define name="GYRO_P_NEUTRAL" value="0"/>
    <define name="GYRO_Q_NEUTRAL" value="0"/>
    <define name="GYRO_R_NEUTRAL" value="-7"/>

    <!--SENS = 16.4 LSB/(deg/sec) * 57.6 deg/rad = 939.650 LSB/rad/sec / 12bit FRAC: 4096 / 939.65 -->
    <define name="GYRO_P_SENS" value="4.359" integer="16"/>
    <define name="GYRO_Q_SENS" value="4.359" integer="16"/>
    <define name="GYRO_R_SENS" value="4.359" integer="16"/>

    <!-- <define name="ACCEL_X_NEUTRAL" value="0"/> -->
    <!-- <define name="ACCEL_Y_NEUTRAL" value="0"/> -->
    <!-- <define name="ACCEL_Z_NEUTRAL" value="0"/> -->
    <!-- <define name="ACCEL_X_SENS" value="4.92297204167" integer="16"/> -->
    <!-- <define name="ACCEL_Y_SENS" value="4.88255070466" integer="16"/> -->
    <!-- <define name="ACCEL_Z_SENS" value="4.86606505696" integer="16"/> -->

    <define name="ACCEL_X_NEUTRAL" value="44"/>
    <define name="ACCEL_Y_NEUTRAL" value="33"/>
    <define name="ACCEL_Z_NEUTRAL" value="-163"/>
    <define name="ACCEL_X_SENS" value="4.91062210988" integer="16"/>
    <define name="ACCEL_Y_SENS" value="4.89961242804" integer="16"/>
    <define name="ACCEL_Z_SENS" value="4.86412752924" integer="16"/>


    <!-- <define name="ACCEL_X_NEUTRAL" value="11"/> -->
    <!-- <define name="ACCEL_Y_NEUTRAL" value="11"/> -->
    <!-- <define name="ACCEL_Z_NEUTRAL" value="-25"/> -->

    <!-- replace this with your own calibration -->
    <!-- <define name="MAG_X_NEUTRAL" value="-179"/> -->
    <!-- <define name="MAG_Y_NEUTRAL" value="-21"/> -->
    <!-- <define name="MAG_Z_NEUTRAL" value="79"/> -->
    <!-- <define name="MAG_X_SENS" value="4.17334785618" integer="16"/> -->
    <!-- <define name="MAG_Y_SENS" value="3.98885954135" integer="16"/> -->
    <!-- <define name="MAG_Z_SENS" value="4.40442339014"
         integer="16"/> -->

    <!-- calibration home -->
    <!-- <define name="MAG_X_NEUTRAL" value="-36"/> -->
    <!-- <define name="MAG_Y_NEUTRAL" value="23"/> -->
    <!-- <define name="MAG_Z_NEUTRAL" value="-2"/> -->
    <!-- <define name="MAG_X_SENS" value="3.57098933709" integer="16"/> -->
    <!-- <define name="MAG_Y_SENS" value="4.08312289904" integer="16"/> -->
    <!-- <define name="MAG_Z_SENS" value="4.37791053594" integer="16"/> -->

    <!-- calibration park -->
    <!-- <define name="MAG_X_NEUTRAL" value="-123"/> -->
    <!-- <define name="MAG_Y_NEUTRAL" value="12"/> -->
    <!-- <define name="MAG_Z_NEUTRAL" value="41"/> -->
    <!-- <define name="MAG_X_SENS" value="3.56903024385" integer="16"/> -->
    <!-- <define name="MAG_Y_SENS" value="3.20928435476" integer="16"/> -->
    <!-- <define name="MAG_Z_SENS" value="4.07291719636" integer="16"/> -->

    <!-- rothspalk old / 2014 -->
    <!-- <define name="MAG_X_NEUTRAL" value="4"/> -->
    <!-- <define name="MAG_Y_NEUTRAL" value="125"/> -->
    <!-- <define name="MAG_Z_NEUTRAL" value="-1"/> -->
    <!-- <define name="MAG_X_SENS" value="3.45222037424" integer="16"/> -->
    <!-- <define name="MAG_Y_SENS" value="3.4215796733" integer="16"/> -->
    <!-- <define name="MAG_Z_SENS" value="3.80450265396" integer="16"/> -->

    <!-- rothspalk halle 1 -->
    <!-- <define name="MAG_X_NEUTRAL" value="28"/> -->
    <!-- <define name="MAG_Y_NEUTRAL" value="-281"/> -->
    <!-- <define name="MAG_Z_NEUTRAL" value="-204"/> -->
    <!-- <define name="MAG_X_SENS" value="3.29628040366" integer="16"/> -->
    <!-- <define name="MAG_Y_SENS" value="3.30882820323" integer="16"/> -->
    <!-- <define name="MAG_Z_SENS" value="3.67428552595" integer="16"/> -->
    <!-- rothspalk outside 1 -->
    <!-- <define name="MAG_X_NEUTRAL" value="39"/> -->
    <!-- <define name="MAG_Y_NEUTRAL" value="-202"/> -->
    <!-- <define name="MAG_Z_NEUTRAL" value="-178"/> -->
    <!-- <define name="MAG_X_SENS" value="3.32794850712" integer="16"/> -->
    <!-- <define name="MAG_Y_SENS" value="2.99799164625" integer="16"/> -->
    <!-- <define name="MAG_Z_SENS" value="3.53878400372" integer="16"/> -->
    <!-- rothspalk outside 2 -->
    <!-- <define name="MAG_X_NEUTRAL" value="32"/> -->
    <!-- <define name="MAG_Y_NEUTRAL" value="-275"/> -->
    <!-- <define name="MAG_Z_NEUTRAL" value="-199"/> -->
    <!-- <define name="MAG_X_SENS" value="3.3071728252" integer="16"/> -->
    <!-- <define name="MAG_Y_SENS" value="3.28340730884" integer="16"/> -->
    <!-- <define name="MAG_Z_SENS" value="3.59872850577" integer="16"/> -->

    <!-- rothspalk averaged over above 201602 -->
    <!-- <define name="MAG_X_NEUTRAL" value="33"/> -->
    <!-- <define name="MAG_Y_NEUTRAL" value="-253"/> -->
    <!-- <define name="MAG_Z_NEUTRAL" value="-194"/> -->
    <!-- <define name="MAG_X_SENS" value="3.31046724533" integer="16"/> -->
    <!-- <define name="MAG_Y_SENS" value="3.19674238611" integer="16"/> -->
    <!-- <define name="MAG_Z_SENS" value="3.60393267848" integer="16"/> -->

    <!-- calibration mdc 2015 -->
    <!-- <define name="MAG_X_NEUTRAL" value="55"/> -->
    <!-- <define name="MAG_Y_NEUTRAL" value="144"/> -->
    <!-- <define name="MAG_Z_NEUTRAL" value="-8"/> -->
    <!-- <define name="MAG_X_SENS" value="3.62696999194" integer="16"/> -->
    <!-- <define name="MAG_Y_SENS" value="3.64414657283" integer="16"/> -->
    <!-- <define name="MAG_Z_SENS" value="4.04501382675" integer="16"/> -->

    <!-- calibration mdc 20160324 -->
    <define name="MAG_X_NEUTRAL" value="-163"/>
    <define name="MAG_Y_NEUTRAL" value="-35"/>
    <define name="MAG_Z_NEUTRAL" value="-131"/>
    <define name="MAG_X_SENS" value="3.49519444005" integer="16"/>
    <define name="MAG_Y_SENS" value="3.52781068304" integer="16"/>
    <define name="MAG_Z_SENS" value="3.88845908855" integer="16"/>

    <define name="BODY_TO_IMU_PHI"   value="0." unit="deg"/>
    <define name="BODY_TO_IMU_THETA" value="0." unit="deg"/>
    <define name="BODY_TO_IMU_PSI"   value="-90." unit="deg"/>
  </section>

  <section name="AHRS" prefix="AHRS_">
    <!-- <define name="H_X" value="0.3770441"/> -->
    <!-- <define name="H_Y" value="0.0193986"/> -->
    <!-- <define name="H_Z" value="0.9259921"/> -->

    <!-- rothspalk 2016: 0.36247056,  0.02101846,  0.93175819 -->
    <!-- unknown (berlin/rothspalk?) -->
    <!-- <define name="H_X" value="0.3773202"/> -->
    <!-- <define name="H_Y" value="0.0211099"/> -->
    <!-- <define name="H_Z" value="0.92584223"/> -->

    <!-- <\!-- mdc 20160329 -\-> -->
    <!-- <define name="H_X" value="0.50568922"/> -->
    <!-- <define name="H_Y" value="0.00832686"/> -->
    <!-- <define name="H_Z" value="0.86267553"/> -->

    <!-- rothspalk 20160410: 0.36247151,  0.02105809,  0.93175692 -->
    <define name="H_X" value="0.36247151"/>
    <define name="H_Y" value="0.02105809"/>
    <define name="H_Z" value="0.93175692"/>

    <!-- include current calibration -->
  </section>

  <section name="INS" prefix="INS_">
  </section>

  <!-- all gains seem way too high -->

  <section name="STABILIZATION_RATE" prefix="STABILIZATION_RATE_">
    <!-- setpoints -->
    <define name="SP_MAX_P" value="10000"/>
    <define name="SP_MAX_Q" value="10000"/>
    <define name="SP_MAX_R" value="10000"/>
    <define name="DEADBAND_P" value="20"/>
    <define name="DEADBAND_Q" value="20"/>
    <define name="DEADBAND_R" value="200"/>
    <define name="REF_TAU" value="4"/>

    <!-- feedback -->
    <!-- <define name="GAIN_P" value="400"/> -->
    <!-- <define name="GAIN_Q" value="400"/> -->
    <!-- <define name="GAIN_R" value="350"/> -->

    <!-- <define name="IGAIN_P" value="75"/> -->
    <!-- <define name="IGAIN_Q" value="75"/> -->
    <!-- <define name="IGAIN_R" value="50"/> -->

    <!-- feedforward -->
    <!-- <define name="DDGAIN_P" value="300"/> -->
    <!-- <define name="DDGAIN_Q" value="300"/> -->
    <!-- <define name="DDGAIN_R" value="300"/> -->

    <!-- feedback -->
    <define name="GAIN_P" value="300"/>
    <define name="GAIN_Q" value="300"/>
    <define name="GAIN_R" value="400"/>

    <define name="IGAIN_P" value="170"/>
    <define name="IGAIN_Q" value="170"/>
    <define name="IGAIN_R" value="120"/>

    <!-- feedforward -->
    <define name="DDGAIN_P" value="30"/>
    <define name="DDGAIN_Q" value="30"/>
    <define name="DDGAIN_R" value="80"/>
  </section>

  <section name="STABILIZATION_ATTITUDE" prefix="STABILIZATION_ATTITUDE_">
    <!-- setpoints -->
    <define name="SP_MAX_PHI"     value="45." unit="deg"/>
    <define name="SP_MAX_THETA"   value="45." unit="deg"/>
    <!-- <define name="SP_MAX_R"       value="90." unit="deg/s"/> -->
    <!-- try increasing that for more yaw oomph -->
    <define name="SP_MAX_R"       value="720." unit="deg/s"/>
    <define name="DEADBAND_A"     value="0"/>
    <define name="DEADBAND_E"     value="0"/>
    <define name="DEADBAND_R"     value="250"/>

    <!-- reference -->
    <define name="REF_OMEGA_P"  value="600" unit="deg/s"/>
    <define name="REF_ZETA_P"   value="0.85"/>
    <define name="REF_MAX_P"    value="600." unit="deg/s"/>
    <define name="REF_MAX_PDOT" value="RadOfDeg(8000.)"/>

    <define name="REF_OMEGA_Q"  value="600" unit="deg/s"/>
    <define name="REF_ZETA_Q"   value="0.85"/>
    <define name="REF_MAX_Q"    value="600." unit="deg/s"/>
    <define name="REF_MAX_QDOT" value="RadOfDeg(8000.)"/>

    <!-- <define name="REF_OMEGA_R"  value="250" unit="deg/s"/> -->
    <!-- <define name="REF_OMEGA_R"  value="350" unit="deg/s"/> -->
    <define name="REF_OMEGA_R"  value="1200" unit="deg/s"/>
    <define name="REF_ZETA_R"   value="0.85"/>
    <!-- <define name="REF_MAX_R"    value="180." unit="deg/s"/> -->
    <define name="REF_MAX_R"    value="1200." unit="deg/s"/>
    <define name="REF_MAX_RDOT" value="RadOfDeg(1800.)"/>

    <!-- feedback -->
    <!-- P 200 up, D 400 down, I 0 or small, DD < P -->
    <!-- <define name="PHI_PGAIN"  value="1500"/> -->
    <!-- <define name="PHI_DGAIN"  value="450"/> -->
    <!-- <define name="PHI_IGAIN"  value="120"/> -->

    <!-- <define name="THETA_PGAIN"  value="1500"/> -->
    <!-- 400 -->
    <!-- <define name="THETA_DGAIN"  value="450"/> -->
    <!-- <define name="THETA_IGAIN"  value="120"/> -->

    <!-- <define name="PSI_PGAIN"  value="500"/> -->
    <!-- 300 -->
    <!-- <define name="PSI_DGAIN"  value="0"/> -->
    <!-- <define name="PSI_IGAIN"  value="10"/> -->

    <!-- <define name="PHI_PGAIN"  value="450"/> -->
    <!-- <define name="PHI_DGAIN"  value="450"/> -->
    <!-- <define name="PHI_IGAIN"  value="60"/> -->

    <!-- <define name="THETA_PGAIN"  value="450"/> -->
    <!-- <define name="THETA_DGAIN"  value="450"/> -->
    <!-- <define name="THETA_IGAIN"  value="60"/> -->

    <!-- <define name="PSI_PGAIN"  value="480"/> -->
    <!-- <define name="PSI_DGAIN"  value="200"/> -->
    <!-- <define name="PSI_IGAIN"  value="20"/> -->

    <!-- feedforward -->
    <!-- <define name="PHI_DDGAIN"   value="160"/> -->
    <!-- <define name="THETA_DDGAIN" value="160"/> -->
    <!-- <define name="PSI_DDGAIN"   value="250"/> -->

    <!-- optim -->
<!-- best five [ -->
<!-- [ 493.          167.          402.          225. -->
<!--   487.           14.          282.          252. -->
<!--   4.60459709] -->

<!-- [ 449.          154.          360.          273. -->
<!--   454.           51.          189.          239. -->
<!--   4.88660908] -->

<!-- [ 472.          156.          352.          287. -->
<!--   445.           40.          242.          299. -->
<!--   5.65769386] -->

<!-- [ 446.          161.          499.          177. -->
<!--   452.           34.          340.          165. -->
<!--   5.81373215] -->

<!-- [ 397.          133.          361.          189. -->
<!--   481.           62.          289.          206. -->
<!--   5.83702564]] -->

<!-- best five [ -->
<!-- [ 470.           93.          229.           38. -->
<!--   450.           97.          440.          103. -->
<!--   6.70843506] -->

<!-- [ 420.           44.          373.          116. -->
<!--   377.          184.          273.          122. -->
<!--   7.20793962] -->

<!-- [ 351.           72.          479.          167. -->
<!--   467.           83.          459.           59. -->
<!--   7.30009747] -->

<!-- [ 393.           78.          498.           10. -->
<!--   321.           56.          403.          219. -->
<!--   7.89704275] -->

<!-- [ 479.           33.          211.          157. -->
<!--   461.          115.          392.           55. -->
<!--   7.92410517]] -->

<!-- from paramopt_ppz_v2_gp_ucb_4D_2.h5 -->
<!-- best five [ -->
<!-- x [ 533.           91.          503.          171. -->
<!--   533.           91.          503.          171.            3.68272543] -->
<!-- x [ 600.          186.          412.          250. -->
<!--   600.          186.          412.          250.            4.59505129] -->
<!-- [ 355.          148.          600.          214. -->
<!--   355.          148.          600.          214.            4.73558807] -->
<!-- [ 417.          143.          564.          227. -->
<!--   417.          143.          564.          227.            5.52406597] -->
<!-- [ 478.          188.          557.          234. -->
<!--   478.          188.          557.          234.            5.60350132]] -->

<!-- optimized -->
    <!-- <define name="PHI_PGAIN" value="355"/> -->
    <!-- <define name="PHI_DGAIN" value="148"/> -->
    <!-- <define name="PHI_IGAIN" value="600"/> -->
    <!-- <\!-- feedforward -\-> -->
    <!-- <define name="PHI_DDGAIN" value="214"/> -->

    <!-- <define name="THETA_PGAIN" value="355"/> -->
    <!-- <define name="THETA_DGAIN" value="148"/> -->
    <!-- <define name="THETA_IGAIN" value="600"/> -->
    <!-- <\!-- feedforward -\-> -->
    <!-- <define name="THETA_DDGAIN" value="214"/> -->

    <!-- manually tuned -->
    <define name="PHI_PGAIN" value="300"/>
    <define name="PHI_DGAIN" value="350"/>
    <define name="PHI_IGAIN" value="100"/>
    <!-- feedforward -->
    <define name="PHI_DDGAIN" value="150"/>

    <define name="THETA_PGAIN" value="300"/>
    <define name="THETA_DGAIN" value="350"/>
    <define name="THETA_IGAIN" value="100"/>
    <!-- feedforward -->
    <define name="THETA_DDGAIN" value="150"/>

    <define name="PSI_PGAIN" value="460"/>
    <define name="PSI_DGAIN" value="210"/>
    <define name="PSI_IGAIN" value="40"/>
    <!-- feedforward -->
    <define name="PSI_DDGAIN" value="110"/>

    <!-- <define name="PSI_PGAIN" value="210"/> -->
    <!-- <define name="PSI_DGAIN" value="400"/> -->
    <!-- <define name="PSI_IGAIN" value="40"/> -->
    <!-- <\!-- feedforward -\-> -->
    <!-- <define name="PSI_DDGAIN" value="61"/> -->


  </section>

  <section name="GUIDANCE_V" prefix="GUIDANCE_V_">
    <define name="MIN_ERR_Z"   value="POS_BFP_OF_REAL(-10.)"/>
    <define name="MAX_ERR_Z"   value="POS_BFP_OF_REAL( 10.)"/>
    <define name="MIN_ERR_ZD"  value="SPEED_BFP_OF_REAL(-10.)"/>
    <define name="MAX_ERR_ZD"  value="SPEED_BFP_OF_REAL( 10.)"/>
    <define name="MAX_SUM_ERR" value="2000000"/>
    <define name="HOVER_KP"    value="150"/>
    <define name="HOVER_KD"    value="80"/>
    <define name="HOVER_KI"    value="20"/>
    <define name="NOMINAL_HOVER_THROTTLE" value="0.5"/>
    <!-- <define name="ADAPT_THROTTLE_ENABLED" value="TRUE"/> -->
    <define name="ADAPT_THROTTLE_ENABLED" value="FALSE"/>
  </section>

  <section name="GUIDANCE_H" prefix="GUIDANCE_H_">
    <define name="MAX_BANK" value="20" unit="deg"/>
    <define name="USE_SPEED_REF" value="TRUE"/>
    <define name="PGAIN" value="50"/>
    <define name="DGAIN" value="100"/>
    <define name="AGAIN" value="100"/>
    <define name="IGAIN" value="20"/>
  </section>

  <section name="SIMULATOR" prefix="NPS_">
    <define name="ACTUATOR_NAMES"  value="{&quot;front_motor&quot;, &quot;back_motor&quot;, &quot;right_motor&quot;, &quot;left_motor&quot;}"/>
    <define name="JSBSIM_INIT" value="&quot;reset00&quot;"/>
    <define name="JSBSIM_MODEL" value="&quot;simple_quad&quot;"/>
    <define name="SENSORS_PARAMS" value="&quot;nps_sensors_params_default.h&quot;"/>
    <!-- mode switch on joystick channel 5 (axis numbering starting at zero) -->
    <define name="JS_AXIS_MODE" value="4"/>
  </section>

  <section name="AUTOPILOT">
    <!-- <define name="MODE_AUTO1"  value="AP_MODE_HOVER_Z_HOLD"/> -->
    <!-- <define name="MODE_AUTO2"  value="AP_MODE_NAV"/> -->

    <!-- <define name="MODE_MANUAL" value="AP_MODE_RATE_DIRECT"/> -->
    <!-- <define name="MODE_AUTO1" value="AP_MODE_ATTITUDE_DIRECT"/> -->
    <!-- <define name="MODE_AUTO2"  value="AP_MODE_HOVER_Z_HOLD"/> -->

    <define name="MODE_MANUAL" value="AP_MODE_ATTITUDE_DIRECT"/>
    <define name="MODE_AUTO1"  value="AP_MODE_HOVER_Z_HOLD"/>
    <define name="MODE_AUTO2"  value="AP_MODE_NAV"/>
  </section>

  <section name="BAT">
    <define name="CATASTROPHIC_BAT_LEVEL" value="9.3" unit="V"/>
    <define name="CRITIC_BAT_LEVEL" value="9.6" unit="V"/>
    <define name="LOW_BAT_LEVEL" value="10.1" unit="V"/>
    <define name="MAX_BAT_LEVEL" value="12.6" unit="V"/>
    <define name="MILLIAMP_AT_FULL_THROTTLE" value="40000"/>
  </section>

</airframe>
